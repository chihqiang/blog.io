<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>golangæ“ä½œredis | å¿—å¼ºvlog</title><meta name="keywords" content="redis"><meta name="description" content="å¿—å¼ºçš„ä¸ªäººåšå®¢ï¼Œåˆ†äº« Node.jsã€PHPã€Goã€Java å’Œ Python åç«¯å¼€å‘ç»éªŒï¼Œä»¥åŠç”Ÿæ´»ä¸­çš„ç‚¹æ»´æ„Ÿæ‚Ÿä¸æ•…äº‹ã€‚
"><meta property="og:type" content="article"><meta property="og:title" content="golangæ“ä½œredis | å¿—å¼ºvlog"><meta property="og:description" content="å¿—å¼ºçš„ä¸ªäººåšå®¢ï¼Œåˆ†äº« Node.jsã€PHPã€Goã€Java å’Œ Python åç«¯å¼€å‘ç»éªŒï¼Œä»¥åŠç”Ÿæ´»ä¸­çš„ç‚¹æ»´æ„Ÿæ‚Ÿä¸æ•…äº‹ã€‚
"><meta property="og:url" content="https://www.zhiqiang.wang/2025/10/09/golang/redis/"><meta property="og:image" content="/img/favicon.ico"><meta property="og:site_name" content="å¿—å¼ºvlog"><meta property="article:published_time" content="Thu Oct 09 2025 10:55:40 GMT+0800"><meta property="article:author" content="ç‹å¿—å¼º"><meta property="article:tag" content="redis"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="golangæ“ä½œredis | å¿—å¼ºvlog"><meta name="twitter:description" content="å¿—å¼ºçš„ä¸ªäººåšå®¢ï¼Œåˆ†äº« Node.jsã€PHPã€Goã€Java å’Œ Python åç«¯å¼€å‘ç»éªŒï¼Œä»¥åŠç”Ÿæ´»ä¸­çš„ç‚¹æ»´æ„Ÿæ‚Ÿä¸æ•…äº‹ã€‚
"><meta name="twitter:image" content="/img/favicon.ico"><script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "golangæ“ä½œredis",
      "image": "/img/favicon.ico",
      "author": {
        "@type": "Person",
        "name": "ç‹å¿—å¼º"
      },
      "datePublished": "Thu Oct 09 2025 10:55:40 GMT+0800",
      "dateModified": "Thu Jan 08 2026 06:03:16 GMT+0000",
      "description": "å¿—å¼ºçš„ä¸ªäººåšå®¢ï¼Œåˆ†äº« Node.jsã€PHPã€Goã€Java å’Œ Python åç«¯å¼€å‘ç»éªŒï¼Œä»¥åŠç”Ÿæ´»ä¸­çš„ç‚¹æ»´æ„Ÿæ‚Ÿä¸æ•…äº‹ã€‚
"
    }</script><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"><script>"dark"===localStorage.getItem("theme")||!localStorage.getItem("theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script src="https://cdn.tailwindcss.com/3.4.16"></script><script>tailwind.config={darkMode:"class",theme:{extend:{}}}</script><script src="https://unpkg.com/alpinejs@3.14.9/dist/cdn.min.js" defer></script><link rel="stylesheet" href="/css/blog.css"><script src="/js/blog.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body class="bg-gradient-to-br from-purple-100 to-blue-100 dark:from-gray-900 dark:to-gray-800 min-h-screen flex flex-col transition-colors duration-300"><nav id="navbar" class="bg-gradient-to-r from-purple-600 to-blue-500 shadow-lg dark:from-gray-800 dark:to-gray-700 transition-all duration-300 sticky top-0 z-40"><div class="container mx-auto px-4 py-3"><div class="flex justify-between items-center"><h1 class="text-white text-xl sm:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 to-pink-400"><a href="/">å¿—å¼ºvlog</a></h1><div id="desktop-menu" class="hidden lg:flex items-center space-x-1"><a href="/" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="0">Home </a><a href="/archives" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="1">Archives </a><a href="/resources" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="2">Rsources </a><a href="/tags" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="3">Tags </a><a href="/about" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="4">About </a><a href="/sitemap.xml" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="5">RSS</a><div id="dropdown-menu" class="relative group hidden"><button class="text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10 flex items-center">æ›´å¤š <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div id="dropdown-content" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0"></div></div></div><div class="flex items-center space-x-1 sm:space-x-2"><button id="searchButton" class="p-2 sm:p-2.5 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-300 text-white hover:scale-110 active:scale-95" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></button> <button id="theme-toggle" class="p-2 sm:p-2.5 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-300 text-white hover:scale-110 active:scale-95" aria-label="åˆ‡æ¢ä¸»é¢˜"><svg id="sun-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg> <svg id="moon-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg></button> <button id="mobile-menu-button" aria-label="åˆ‡æ¢èœå•" class="lg:hidden p-2 sm:p-2.5 rounded-lg hover:bg-white/10 transition-all duration-300 text-white hover:scale-110 active:scale-95"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div></div></div><div id="mobile-menu" class="lg:hidden hidden bg-gradient-to-r from-purple-600 to-blue-500 dark:from-gray-800 dark:to-gray-700 px-4 pb-4 transition-all duration-300"><div class="space-y-1"><a href="/" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Home</span> </a><a href="/archives" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Archives</span> </a><a href="/resources" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Rsources</span> </a><a href="/tags" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Tags</span> </a><a href="/about" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">About</span> </a><a href="/sitemap.xml" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">RSS</span></a></div></div></nav><div id="searchOverlay" class="overlay hidden"></div><div id="inputContainer" class="floating-search hidden"><input type="text" id="inputField" placeholder="æœç´¢æ–‡ç« ..." class="search-input" autocomplete="off"><div id="articleList" class="search-results"></div></div><script>document.addEventListener("DOMContentLoaded",DOMContentLoadedSearch)</script><div id="reading-progress" class="fixed top-0 left-0 h-1 bg-gradient-to-r from-purple-500 to-blue-500 z-50 transition-all duration-150" style="width:0%"></div><div class="container mx-auto px-4 py-8"><article class="bg-white p-6 sm:p-8 rounded-xl shadow-lg transition hover:scale-[1.01] max-w-5xl mx-auto mt-8"><header class="mb-6 sm:mb-8"><h1 class="text-3xl sm:text-4xl font-bold mb-3 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">golangæ“ä½œredis</h1><div class="flex flex-wrap items-center text-gray-500 text-sm space-x-4"><span>2025-10-09</span> <span><a href="/categories/golang/" class="text-blue-600 hover:underline">golang</a> </span><span><a href="/tags/redis/" class="text-blue-600 hover:underline">redis</a></span></div></header><div class="article-content prose prose-base lg:prose-lg max-w-none"><p>ç›®å‰ Go ç”Ÿæ€é‡Œï¼Œæœ€ç‚™æ‰‹å¯çƒ­çš„ Redis å®¢æˆ·ç«¯é <strong>go-redis</strong> è«å±ã€‚</p><p><strong>äº®ç‚¹æ»¡æ»¡ï¼š</strong></p><ul><li><strong>åŸç”Ÿ Go å®ç°</strong>ï¼Œæ€§èƒ½æ æ çš„ï¼Œè·‘å¾—é£å¿«</li><li><strong>å†…ç½®è¿æ¥æ± </strong>ï¼Œé«˜å¹¶å‘ä¹Ÿä¸æ€µ</li><li><strong>å…¨é¢ç‰¹æ€§æ”¯æŒ</strong>ï¼šé›†ç¾¤ã€å“¨å…µã€ç®¡é“ã€äº‹åŠ¡ï¼Œåº”æœ‰å°½æœ‰</li></ul><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/redis/go-redis/v9</span><br></pre></td></tr></table></figure><h1 id="å¿«é€Ÿä¸Šæ‰‹ï¼šGo-ä¸-Redis-æ¥ä¸€åœºé«˜æ•ˆçº¦ä¼š"><a href="#å¿«é€Ÿä¸Šæ‰‹ï¼šGo-ä¸-Redis-æ¥ä¸€åœºé«˜æ•ˆçº¦ä¼š" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹ï¼šGo ä¸ Redis æ¥ä¸€åœºé«˜æ•ˆçº¦ä¼š"></a>å¿«é€Ÿä¸Šæ‰‹ï¼šGo ä¸ Redis æ¥ä¸€åœºé«˜æ•ˆçº¦ä¼š</h1><h2 id="è¿æ¥-Redis"><a href="#è¿æ¥-Redis" class="headerlink" title="è¿æ¥ Redis"></a>è¿æ¥ Redis</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">package</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="string">import</span> <span class="string">(</span></span><br><span class="line"> <span class="string">&quot;context&quot;</span></span><br><span class="line"> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">var</span> <span class="string">ctx</span> <span class="string">=</span> <span class="string">context.Background()</span></span><br><span class="line"></span><br><span class="line"><span class="string">func</span> <span class="string">main()</span> &#123;</span><br><span class="line"> <span class="string">rdb</span> <span class="string">:=</span> <span class="string">redis.NewClient(&amp;redis.Options</span>&#123;</span><br><span class="line">  <span class="attr">Addr:</span>     <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">  <span class="attr">Password:</span> <span class="string">&quot;&quot;</span>, <span class="string">//</span> <span class="literal">no</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">DB:</span>       <span class="number">0</span>,  <span class="string">//</span> <span class="string">use</span> <span class="string">default</span> <span class="string">DB</span></span><br><span class="line"> &#125;<span class="string">)</span></span><br><span class="line"> <span class="string">_</span>, <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.Ping(ctx).Result()</span></span><br><span class="line"> <span class="string">if</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">  <span class="string">panic(err)</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="string">fmt.Println(&quot;Redis</span> <span class="string">è¿æ¥æˆåŠŸï¼&quot;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ‰‹åˆ°æ“’æ¥ï¼šRedis-å¸¸ç”¨æ“ä½œé€Ÿæˆ"><a href="#æ‰‹åˆ°æ“’æ¥ï¼šRedis-å¸¸ç”¨æ“ä½œé€Ÿæˆ" class="headerlink" title="æ‰‹åˆ°æ“’æ¥ï¼šRedis å¸¸ç”¨æ“ä½œé€Ÿæˆ"></a>æ‰‹åˆ°æ“’æ¥ï¼šRedis å¸¸ç”¨æ“ä½œé€Ÿæˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å†™å…¥é”®å€¼</span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;chihqiang&quot;</span>, 0)</span><br><span class="line">// è¯»å–é”®å€¼</span><br><span class="line">val, _ := rdb.Get(ctx, <span class="string">&quot;username&quot;</span>).Result()</span><br><span class="line">fmt.Println(<span class="string">&quot;username:&quot;</span>, val)</span><br><span class="line">// è‡ªå¢è®¡æ•°å™¨</span><br><span class="line">rdb.Incr(ctx, <span class="string">&quot;counter&quot;</span>)</span><br><span class="line">// è®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;token:chihqiang&quot;</span>, <span class="string">&quot;123456&quot;</span>, time.Minute)</span><br></pre></td></tr></table></figure><h1 id="å®æˆ˜æ¼”ç»ƒï¼šRedis-å…¸å‹ä¸šåŠ¡åœºæ™¯å…¨æ­ç§˜"><a href="#å®æˆ˜æ¼”ç»ƒï¼šRedis-å…¸å‹ä¸šåŠ¡åœºæ™¯å…¨æ­ç§˜" class="headerlink" title="å®æˆ˜æ¼”ç»ƒï¼šRedis å…¸å‹ä¸šåŠ¡åœºæ™¯å…¨æ­ç§˜"></a>å®æˆ˜æ¼”ç»ƒï¼šRedis å…¸å‹ä¸šåŠ¡åœºæ™¯å…¨æ­ç§˜</h1><h2 id="ç¼“å­˜æŒæ§æœ¯ï¼šCache-Aside-æ¨¡å¼è¯¦è§£"><a href="#ç¼“å­˜æŒæ§æœ¯ï¼šCache-Aside-æ¨¡å¼è¯¦è§£" class="headerlink" title="ç¼“å­˜æŒæ§æœ¯ï¼šCache Aside æ¨¡å¼è¯¦è§£"></a>ç¼“å­˜æŒæ§æœ¯ï¼šCache Aside æ¨¡å¼è¯¦è§£</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">package</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="string">import</span> <span class="string">(</span></span><br><span class="line"> <span class="string">&quot;context&quot;</span></span><br><span class="line"> <span class="string">&quot;log&quot;</span></span><br><span class="line"> <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">var</span> <span class="string">ctx</span> <span class="string">=</span> <span class="string">context.Background()</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">GetUserUnified</span> <span class="string">ä¸€ä¸ªæ–¹æ³•æå®šå•ä¸ª/æ‰¹é‡è·å–å’Œç¼“å­˜åˆ·æ–°</span></span><br><span class="line"><span class="string">//</span> <span class="attr">ids:</span> <span class="string">ç”¨æˆ·</span> <span class="string">ID</span> <span class="string">åˆ—è¡¨</span></span><br><span class="line"><span class="string">//</span> <span class="attr">refresh:</span> <span class="string">æ˜¯å¦å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</span></span><br><span class="line"><span class="string">//</span> <span class="attr">dbQuery:</span> <span class="string">æ•°æ®åº“æŸ¥è¯¢å‡½æ•°ï¼Œå¤–éƒ¨ä¼ å…¥</span></span><br><span class="line"><span class="string">func</span> <span class="string">GetUserUnified(rdb</span> <span class="string">*redis.Client,</span> <span class="string">ids</span> []<span class="string">string,</span> <span class="string">refresh</span> <span class="string">bool,</span> <span class="string">dbQuery</span> <span class="string">func(id</span> <span class="string">string)</span> <span class="string">string)</span> <span class="string">(map[string]string,</span> <span class="string">error)</span> &#123;</span><br><span class="line"> <span class="string">result</span> <span class="string">:=</span> <span class="string">make(map</span>[<span class="string">string</span>]<span class="string">string)</span></span><br><span class="line"></span><br><span class="line"> <span class="string">for</span> <span class="string">_</span>, <span class="string">id</span> <span class="string">:=</span> <span class="string">range</span> <span class="string">ids</span> &#123;</span><br><span class="line">  <span class="string">key</span> <span class="string">:=</span> <span class="string">&quot;user:&quot;</span> <span class="string">+</span> <span class="string">id</span></span><br><span class="line">  <span class="string">var</span> <span class="string">user</span> <span class="string">string</span></span><br><span class="line">  <span class="string">var</span> <span class="string">err</span> <span class="string">error</span></span><br><span class="line"></span><br><span class="line">  <span class="string">if</span> <span class="type">!refresh</span> &#123;</span><br><span class="line">   <span class="string">//</span> <span class="string">å°è¯•ä»ç¼“å­˜è·å–</span></span><br><span class="line">   <span class="string">user</span>, <span class="string">err</span> <span class="string">=</span> <span class="string">rdb.Get(ctx</span>, <span class="string">key).Result()</span></span><br><span class="line">   <span class="string">if</span> <span class="string">err</span> <span class="string">==</span> <span class="string">nil</span> &#123;</span><br><span class="line">    <span class="string">log.Println(&quot;ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›:&quot;</span>, <span class="string">key)</span></span><br><span class="line">    <span class="string">result</span>[<span class="string">id</span>] <span class="string">=</span> <span class="string">user</span></span><br><span class="line">    <span class="string">continue</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="string">if</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">redis.Nil</span> &#123;</span><br><span class="line">    <span class="string">log.Println(&quot;Redis</span> <span class="string">å‡ºé”™:&quot;</span>, <span class="string">err)</span></span><br><span class="line">    <span class="string">continue</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="string">log.Println(&quot;ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹ä»æ•°æ®åº“æŸ¥è¯¢:&quot;</span>, <span class="string">key)</span></span><br><span class="line">  &#125; <span class="string">else</span> &#123;</span><br><span class="line">   <span class="string">log.Println(&quot;å¼ºåˆ¶åˆ·æ–°ç¼“å­˜:&quot;</span>, <span class="string">key)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">//</span> <span class="string">ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè°ƒç”¨å¤–éƒ¨ä¼ å…¥çš„å‡½æ•°ï¼‰</span></span><br><span class="line">  <span class="string">user</span> <span class="string">=</span> <span class="string">dbQuery(id)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">//</span> <span class="string">å›å†™ç¼“å­˜</span></span><br><span class="line">  <span class="string">if</span> <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.Set(ctx</span>, <span class="string">key</span>, <span class="string">user</span>, <span class="number">10</span><span class="string">*time.Minute).Err();</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">   <span class="string">log.Println(&quot;ç¼“å­˜å›å†™å¤±è´¥:&quot;</span>, <span class="string">key</span>, <span class="string">err)</span></span><br><span class="line">  &#125; <span class="string">else</span> &#123;</span><br><span class="line">   <span class="string">log.Println(&quot;ç¼“å­˜å·²å›å†™</span> <span class="string">Redis:&quot;</span>, <span class="string">key)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">result</span>[<span class="string">id</span>] <span class="string">=</span> <span class="string">user</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="string">return</span> <span class="string">result</span>, <span class="string">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">func</span> <span class="string">main()</span> &#123;</span><br><span class="line"> <span class="string">//</span> <span class="string">åˆå§‹åŒ–</span> <span class="string">Redis</span> <span class="string">å®¢æˆ·ç«¯</span></span><br><span class="line"> <span class="string">rdb</span> <span class="string">:=</span> <span class="string">redis.NewClient(&amp;redis.Options</span>&#123;</span><br><span class="line">  <span class="attr">Addr:</span>     <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">  <span class="attr">Password:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">DB:</span>       <span class="number">0</span>,</span><br><span class="line"> &#125;<span class="string">)</span></span><br><span class="line"></span><br><span class="line"> <span class="string">//</span> <span class="string">è‡ªå®šä¹‰æ•°æ®åº“æŸ¥è¯¢å‡½æ•°</span></span><br><span class="line"> <span class="string">dbQuery</span> <span class="string">:=</span> <span class="string">func(id</span> <span class="string">string)</span> <span class="string">string</span> &#123;</span><br><span class="line">  <span class="string">//</span> <span class="string">æ¨¡æ‹ŸæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">  <span class="string">return</span> <span class="string">&quot;db_user_&quot;</span> <span class="string">+</span> <span class="string">id</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="string">//</span> <span class="string">å•ä¸ªç”¨æˆ·è·å–</span></span><br><span class="line"> <span class="string">userMap</span>, <span class="string">_</span> <span class="string">:=</span> <span class="string">GetUserUnified(rdb</span>, []<span class="string">string</span>&#123;<span class="string">&quot;1001&quot;</span>&#125;, <span class="literal">false</span>, <span class="string">dbQuery)</span></span><br><span class="line"> <span class="string">log.Println(&quot;ç”¨æˆ·</span> <span class="number">1001</span><span class="string">:&quot;</span>, <span class="string">userMap</span>[<span class="string">&quot;1001&quot;</span>]<span class="string">)</span></span><br><span class="line"></span><br><span class="line"> <span class="string">//</span> <span class="string">æ‰¹é‡ç”¨æˆ·è·å–</span></span><br><span class="line"> <span class="string">ids</span> <span class="string">:=</span> []<span class="string">string</span>&#123;<span class="string">&quot;1001&quot;</span>, <span class="string">&quot;1002&quot;</span>, <span class="string">&quot;1003&quot;</span>&#125;</span><br><span class="line"> <span class="string">users</span>, <span class="string">_</span> <span class="string">:=</span> <span class="string">GetUserUnified(rdb</span>, <span class="string">ids</span>, <span class="literal">false</span>, <span class="string">dbQuery)</span></span><br><span class="line"> <span class="string">log.Println(&quot;æ‰¹é‡ç”¨æˆ·:&quot;</span>, <span class="string">users)</span></span><br><span class="line"></span><br><span class="line"> <span class="string">//</span> <span class="string">å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</span></span><br><span class="line"> <span class="string">usersRefresh</span>, <span class="string">_</span> <span class="string">:=</span> <span class="string">GetUserUnified(rdb</span>, []<span class="string">string</span>&#123;<span class="string">&quot;1002&quot;</span>&#125;, <span class="literal">true</span>, <span class="string">dbQuery)</span></span><br><span class="line"> <span class="string">log.Println(&quot;åˆ·æ–°ç¼“å­˜åçš„ç”¨æˆ·</span> <span class="number">1002</span><span class="string">:&quot;</span>, <span class="string">usersRefresh</span>[<span class="string">&quot;1002&quot;</span>]<span class="string">)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€è·¯</p><p><strong>Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰æ¨¡å¼</strong>ï¼š</p><ol><li>å…ˆå°è¯•ä»ç¼“å­˜è·å–æ•°æ®ã€‚</li><li>ç¼“å­˜æœªå‘½ä¸­ â†’ å›æºæ•°æ®åº“æŸ¥è¯¢ã€‚</li><li>æŸ¥è¯¢åˆ°æ•°æ®åº“æ•°æ®åå›å†™ç¼“å­˜ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰ã€‚</li><li>è¿”å›æœ€ç»ˆç»“æœã€‚</li></ol><h2 id="é”å®šé£é™©ï¼šCache-Aside-åˆ†å¸ƒå¼é”é˜²è¶…å–"><a href="#é”å®šé£é™©ï¼šCache-Aside-åˆ†å¸ƒå¼é”é˜²è¶…å–" class="headerlink" title="é”å®šé£é™©ï¼šCache Aside + åˆ†å¸ƒå¼é”é˜²è¶…å–"></a>é”å®šé£é™©ï¼šCache Aside + åˆ†å¸ƒå¼é”é˜²è¶…å–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;context&quot;</span></span><br><span class="line"> <span class="string">&quot;log&quot;</span></span><br><span class="line"> <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.<span class="title class_">Background</span>()</span><br><span class="line"><span class="keyword">var</span> rdb *redis.<span class="property">Client</span> <span class="comment">// å‡è®¾å·²åˆå§‹åŒ– Redis å®¢æˆ·ç«¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// AcquireLock å°è¯•è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line">func <span class="title class_">AcquireLock</span>(key, value string, ttl time.<span class="property">Duration</span>) bool &#123;</span><br><span class="line"> ok, err := rdb.<span class="title class_">SetNX</span>(ctx, key, value, ttl).<span class="title class_">Result</span>()</span><br><span class="line"> <span class="keyword">if</span> err != nil &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;è·å–é”å‡ºé”™:&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> ok &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;é”è·å–æˆåŠŸ:&quot;</span>, key)</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;é”è·å–å¤±è´¥ï¼Œå·²è¢«å ç”¨:&quot;</span>, key)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReleaseLock é‡Šæ”¾åˆ†å¸ƒå¼é”</span></span><br><span class="line">func <span class="title class_">ReleaseLock</span>(key, value string) &#123;</span><br><span class="line"> luaScript := <span class="string">`</span></span><br><span class="line"><span class="string">        if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">            return redis.call(&quot;del&quot;, KEYS[1])</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line"> res, err := rdb.<span class="title class_">Eval</span>(ctx, luaScript, []string&#123;key&#125;, value).<span class="title class_">Result</span>()</span><br><span class="line"> <span class="keyword">if</span> err != nil &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;é‡Šæ”¾é”å‡ºé”™:&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> res.(int64) &gt; <span class="number">0</span> &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;é”å·²é‡Šæ”¾:&quot;</span>, key)</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  log.<span class="title class_">Println</span>(<span class="string">&quot;æœªé‡Šæ”¾é”ï¼ˆå¯èƒ½ä¸æ˜¯è‡ªå·±çš„é”ï¼‰:&quot;</span>, key)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‰ é«˜å¹¶å‘æŠ¤ç›¾</strong>ï¼šé€šè¿‡ SETNX + EXPIRE æˆ– Redlock ç®—æ³•ï¼Œè½»æ¾é˜²æ­¢å¤šä¸ªæœåŠ¡åŒæ—¶æ“ä½œåŒä¸€èµ„æºã€‚</p><p><strong>ğŸ” åˆ†å¸ƒå¼é”æµç¨‹å›¾</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Client A å°è¯•è·å–é” â†’ SETNX æˆåŠŸ â†’ æ‰§è¡Œä¸šåŠ¡ â†’ é‡Šæ”¾é”</span><br><span class="line">Client B å°è¯•è·å–é” â†’ SETNX å¤±è´¥ â†’ ç­‰å¾…æˆ–é‡è¯•</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ•°é£äº‘æ¦œï¼šRedis-æ’è¡Œæ¦œå…¸å‹ä¸šåŠ¡åœºæ™¯"><a href="#åˆ†æ•°é£äº‘æ¦œï¼šRedis-æ’è¡Œæ¦œå…¸å‹ä¸šåŠ¡åœºæ™¯" class="headerlink" title="åˆ†æ•°é£äº‘æ¦œï¼šRedis æ’è¡Œæ¦œå…¸å‹ä¸šåŠ¡åœºæ™¯"></a>åˆ†æ•°é£äº‘æ¦œï¼šRedis æ’è¡Œæ¦œå…¸å‹ä¸šåŠ¡åœºæ™¯</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">package</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="string">import</span> <span class="string">(</span></span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">var</span> <span class="string">ctx</span> <span class="string">=</span> <span class="string">context.Background()</span></span><br><span class="line"></span><br><span class="line"><span class="string">func</span> <span class="string">main()</span> &#123;</span><br><span class="line">    <span class="string">//</span> <span class="string">åˆå§‹åŒ–</span> <span class="string">Redis</span> <span class="string">å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="string">rdb</span> <span class="string">:=</span> <span class="string">redis.NewClient(&amp;redis.Options</span>&#123;</span><br><span class="line">        <span class="attr">Addr:</span> <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">        <span class="attr">DB:</span>   <span class="number">0</span>,</span><br><span class="line">    &#125;<span class="string">)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">//</span> <span class="string">ğŸŒŸ</span> <span class="string">æ·»åŠ ç©å®¶åˆ†æ•°åˆ°æ’è¡Œæ¦œï¼ˆZSetï¼‰</span></span><br><span class="line">    <span class="string">players</span> <span class="string">:=</span> []<span class="string">struct</span> &#123;</span><br><span class="line">        <span class="string">name</span>  <span class="string">string</span></span><br><span class="line">        <span class="string">score</span> <span class="string">float64</span></span><br><span class="line">    &#125;&#123;</span><br><span class="line">        &#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">200</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;Charlie&quot;</span>, <span class="number">150</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">for</span> <span class="string">_</span>, <span class="string">p</span> <span class="string">:=</span> <span class="string">range</span> <span class="string">players</span> &#123;</span><br><span class="line">        <span class="string">if</span> <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.ZAdd(ctx</span>, <span class="string">&quot;rank&quot;</span>, <span class="string">redis.Z</span>&#123;<span class="attr">Score:</span> <span class="string">p.score</span>, <span class="attr">Member:</span> <span class="string">p.name</span>&#125;<span class="string">).Err();</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">            <span class="string">log.Println(&quot;æ·»åŠ åˆ†æ•°å¤±è´¥:&quot;</span>, <span class="string">p.name</span>, <span class="string">err)</span></span><br><span class="line">        &#125; <span class="string">else</span> &#123;</span><br><span class="line">            <span class="string">log.Printf(&quot;å·²æ·»åŠ åˆ†æ•°:</span> <span class="string">%s</span> <span class="string">-&gt;</span> <span class="string">%f\n&quot;</span>, <span class="string">p.name</span>, <span class="string">p.score)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span> <span class="string">ğŸ†</span> <span class="string">è·å–æ’è¡Œæ¦œå‰</span> <span class="number">10</span> <span class="string">å</span></span><br><span class="line">    <span class="string">res</span>, <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.ZRevRangeWithScores(ctx</span>, <span class="string">&quot;rank&quot;</span>, <span class="number">0</span>, <span class="number">9</span><span class="string">).Result()</span></span><br><span class="line">    <span class="string">if</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">        <span class="string">log.Println(&quot;è·å–æ’è¡Œæ¦œå¤±è´¥:&quot;</span>, <span class="string">err)</span></span><br><span class="line">        <span class="string">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">fmt.Println(&quot;ğŸ…</span> <span class="string">å½“å‰æ’è¡Œæ¦œå‰</span> <span class="number">10</span> <span class="string">åï¼š&quot;)</span></span><br><span class="line">    <span class="string">for</span> <span class="string">i</span>, <span class="string">z</span> <span class="string">:=</span> <span class="string">range</span> <span class="string">res</span> &#123;</span><br><span class="line">        <span class="string">fmt.Printf(&quot;ç¬¬%då:</span> <span class="string">%s</span> <span class="bullet">-</span> <span class="string">%.0f</span> <span class="string">åˆ†\n&quot;</span>, <span class="string">i+1</span>, <span class="string">z.Member</span>, <span class="string">z.Score)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€è·¯</p><ul><li>ä½¿ç”¨ <strong>Redis æœ‰åºé›†åˆï¼ˆZSetï¼‰</strong> æ¥å­˜å‚¨ç©å®¶å’Œåˆ†æ•°ã€‚</li><li><strong>Score</strong> å­—æ®µè¡¨ç¤ºåˆ†æ•°ï¼Œ<strong>Member</strong> å­—æ®µè¡¨ç¤ºç©å®¶åç§°ã€‚</li><li>åˆ©ç”¨ ZSet çš„ <strong>è‡ªåŠ¨æ’åº</strong> ç‰¹æ€§ï¼Œå¯ä»¥å¿«é€Ÿè·å–æ’è¡Œæ¦œå‰ N åã€‚</li></ul><h2 id="å°å·§æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedis-é˜Ÿåˆ—åº”ç”¨åœºæ™¯"><a href="#å°å·§æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedis-é˜Ÿåˆ—åº”ç”¨åœºæ™¯" class="headerlink" title="å°å·§æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedis é˜Ÿåˆ—åº”ç”¨åœºæ™¯"></a>å°å·§æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedis é˜Ÿåˆ—åº”ç”¨åœºæ™¯</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">package</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="string">import</span> <span class="string">(</span></span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">var</span> <span class="string">ctx</span> <span class="string">=</span> <span class="string">context.Background()</span></span><br><span class="line"></span><br><span class="line"><span class="string">func</span> <span class="string">main()</span> &#123;</span><br><span class="line">    <span class="string">//</span> <span class="string">åˆå§‹åŒ–</span> <span class="string">Redis</span> <span class="string">å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="string">rdb</span> <span class="string">:=</span> <span class="string">redis.NewClient(&amp;redis.Options</span>&#123;</span><br><span class="line">        <span class="attr">Addr:</span> <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">        <span class="attr">DB:</span>   <span class="number">0</span>,</span><br><span class="line">    &#125;<span class="string">)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">//</span> <span class="string">ğŸŒŸ</span> <span class="string">ç”Ÿäº§è€…ï¼šå¾€é˜Ÿåˆ—ä¸­æ¨é€ä»»åŠ¡</span></span><br><span class="line">    <span class="string">tasks</span> <span class="string">:=</span> []<span class="string">string</span>&#123;<span class="string">&quot;task1&quot;</span>, <span class="string">&quot;task2&quot;</span>, <span class="string">&quot;task3&quot;</span>&#125;</span><br><span class="line">    <span class="string">for</span> <span class="string">_</span>, <span class="string">t</span> <span class="string">:=</span> <span class="string">range</span> <span class="string">tasks</span> &#123;</span><br><span class="line">        <span class="string">if</span> <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.LPush(ctx</span>, <span class="string">&quot;queue&quot;</span>, <span class="string">t).Err();</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">            <span class="string">log.Println(&quot;æ¨é€ä»»åŠ¡å¤±è´¥:&quot;</span>, <span class="string">t</span>, <span class="string">err)</span></span><br><span class="line">        &#125; <span class="string">else</span> &#123;</span><br><span class="line">            <span class="string">log.Println(&quot;å·²æ¨é€ä»»åŠ¡åˆ°é˜Ÿåˆ—:&quot;</span>, <span class="string">t)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span> <span class="string">ğŸƒ</span> <span class="string">æ¶ˆè´¹è€…ï¼ˆé˜»å¡å¼ï¼‰</span></span><br><span class="line">    <span class="string">log.Println(&quot;å¼€å§‹æ¶ˆè´¹é˜Ÿåˆ—ä»»åŠ¡...&quot;)</span></span><br><span class="line">    <span class="string">for</span> &#123;</span><br><span class="line">        <span class="string">//</span> <span class="string">BRPop</span> <span class="string">é˜»å¡å¼å¼¹å‡ºé˜Ÿåˆ—ä»»åŠ¡ï¼Œé˜Ÿåˆ—ä¸ºç©ºæ—¶ç­‰å¾…</span></span><br><span class="line">        <span class="string">result</span>, <span class="string">err</span> <span class="string">:=</span> <span class="string">rdb.BRPop(ctx</span>, <span class="number">0</span>, <span class="string">&quot;queue&quot;</span><span class="string">).Result()</span></span><br><span class="line">        <span class="string">if</span> <span class="string">err</span> <span class="type">!=</span> <span class="string">nil</span> &#123;</span><br><span class="line">            <span class="string">log.Println(&quot;æ¶ˆè´¹ä»»åŠ¡å¤±è´¥:&quot;</span>, <span class="string">err)</span></span><br><span class="line">            <span class="string">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">//</span> <span class="string">result</span>[<span class="number">0</span>] <span class="string">æ˜¯é˜Ÿåˆ—åï¼Œresult</span>[<span class="number">1</span>] <span class="string">æ˜¯ä»»åŠ¡å†…å®¹</span></span><br><span class="line">        <span class="string">task</span> <span class="string">:=</span> <span class="string">result</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="string">fmt.Println(&quot;æ¶ˆè´¹ä»»åŠ¡ï¼š&quot;</span>, <span class="string">task)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€è·¯</p><ul><li>åˆ©ç”¨ <strong>Redis åˆ—è¡¨ï¼ˆListï¼‰</strong> å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ”¯æŒç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚</li><li><strong>LPUSH</strong>ï¼šç”Ÿäº§è€…å‘é˜Ÿåˆ—å¤´éƒ¨æ·»åŠ ä»»åŠ¡ã€‚</li><li><strong>BRPOP</strong>ï¼šæ¶ˆè´¹è€…ä»é˜Ÿåˆ—å°¾éƒ¨é˜»å¡å¼è·å–ä»»åŠ¡ï¼Œé˜Ÿåˆ—ä¸ºç©ºæ—¶è‡ªåŠ¨ç­‰å¾…ã€‚</li></ul><h1 id="æ€§èƒ½é£è·ƒï¼šRedis-ä¼˜åŒ–æŠ€å·§ä¸æœ€ä½³å®è·µ"><a href="#æ€§èƒ½é£è·ƒï¼šRedis-ä¼˜åŒ–æŠ€å·§ä¸æœ€ä½³å®è·µ" class="headerlink" title="æ€§èƒ½é£è·ƒï¼šRedis ä¼˜åŒ–æŠ€å·§ä¸æœ€ä½³å®è·µ"></a>æ€§èƒ½é£è·ƒï¼šRedis ä¼˜åŒ–æŠ€å·§ä¸æœ€ä½³å®è·µ</h1><h2 id="åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…ç¼“å­˜é›ªå´©"><a href="#åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…ç¼“å­˜é›ªå´©" class="headerlink" title="åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…ç¼“å­˜é›ªå´©"></a>åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…ç¼“å­˜é›ªå´©</h2><ol><li><strong>ä½¿ç”¨éšæœºè¿‡æœŸæ—¶é—´ï¼ˆé”™å³°è¿‡æœŸï¼‰</strong><ul><li>ç»™ç¼“å­˜è®¾ç½®ç•¥å¾®ä¸åŒçš„ TTLï¼Œé¿å…å¤§é‡ key åŒæ—¶è¿‡æœŸå¯¼è‡´ç¬é—´æµé‡æ‰“åˆ°æ•°æ®åº“ã€‚</li><li>ç¤ºä¾‹ï¼š<code>10min + rand(0~5min)</code></li></ul></li><li><strong>ç»“åˆæœ¬åœ°ç¼“å­˜</strong><ul><li>åœ¨åº”ç”¨ç«¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚ Go mapã€LRUï¼‰ä¿å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘å¯¹ Redis çš„ç¬æ—¶å‹åŠ›ã€‚</li><li>çƒ­ç‚¹æ•°æ®å…ˆä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼Œå†å›é€€åˆ° Redisï¼Œæœ€åæŸ¥æ•°æ®åº“ã€‚</li></ul></li></ol><h3 id="ä½¿ç”¨è¿æ¥æ± ï¼Œæå‡-Redis-æ€§èƒ½"><a href="#ä½¿ç”¨è¿æ¥æ± ï¼Œæå‡-Redis-æ€§èƒ½" class="headerlink" title="ä½¿ç”¨è¿æ¥æ± ï¼Œæå‡ Redis æ€§èƒ½"></a>ä½¿ç”¨è¿æ¥æ± ï¼Œæå‡ Redis æ€§èƒ½</h3><ul><li><strong>Go-Redis é»˜è®¤å†…ç½®è¿æ¥æ± </strong><ul><li>è‡ªåŠ¨ç®¡ç†è¿æ¥å¤ç”¨ï¼Œæ”¯æŒé«˜å¹¶å‘è¯·æ±‚ã€‚</li></ul></li><li><strong>å¸¸è§é…ç½®é¡¹</strong>ï¼š<ol><li><code>PoolSize</code>ï¼šè¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ã€‚</li><li><code>MinIdleConns</code>ï¼šæœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œä¿è¯è¯·æ±‚é«˜å³°æ—¶æœ‰å¯ç”¨è¿æ¥ã€‚</li><li><code>IdleTimeout</code>ï¼šç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡åˆ™å…³é—­ã€‚</li><li><code>DialTimeout / ReadTimeout / WriteTimeout</code>ï¼šæ§åˆ¶è¿æ¥å»ºç«‹å’Œè¯»å†™è¶…æ—¶ï¼Œé˜²æ­¢è¯·æ±‚é˜»å¡ã€‚</li></ol></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– Redis å®¢æˆ·ç«¯ï¼ˆå¸¦è¿æ¥æ± é…ç½®ï¼‰</span></span><br><span class="line">rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line"> Addr:         <span class="string">&quot;localhost:6379&quot;</span>, <span class="comment">// Redis åœ°å€</span></span><br><span class="line"> Password:     <span class="string">&quot;&quot;</span>,               <span class="comment">// Redis å¯†ç ï¼ˆå¦‚æœ‰ï¼‰</span></span><br><span class="line"> DB:           <span class="number">0</span>,                <span class="comment">// ä½¿ç”¨çš„æ•°æ®åº“</span></span><br><span class="line"> PoolSize:     <span class="number">50</span>,               <span class="comment">// æœ€å¤§è¿æ¥æ•°ï¼Œæ ¹æ®å¹¶å‘é‡è°ƒæ•´</span></span><br><span class="line"> MinIdleConns: <span class="number">10</span>,               <span class="comment">// æœ€å°ç©ºé—²è¿æ¥ï¼Œä¿è¯é«˜å³°æœŸæœ‰å¯ç”¨è¿æ¥</span></span><br><span class="line"> DialTimeout:  <span class="number">5</span> * time.Second,  <span class="comment">// å»ºç«‹è¿æ¥è¶…æ—¶</span></span><br><span class="line"> ReadTimeout:  <span class="number">3</span> * time.Second,  <span class="comment">// è¯»æ“ä½œè¶…æ—¶</span></span><br><span class="line"> WriteTimeout: <span class="number">3</span> * time.Second,  <span class="comment">// å†™æ“ä½œè¶…æ—¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="æ‰¹é‡æ“ä½œï¼šä½¿ç”¨-Pipeline-æˆ–-MGet-å‡å°‘-RTT"><a href="#æ‰¹é‡æ“ä½œï¼šä½¿ç”¨-Pipeline-æˆ–-MGet-å‡å°‘-RTT" class="headerlink" title="æ‰¹é‡æ“ä½œï¼šä½¿ç”¨ Pipeline æˆ– MGet å‡å°‘ RTT"></a>æ‰¹é‡æ“ä½œï¼šä½¿ç”¨ Pipeline æˆ– MGet å‡å°‘ RTT</h3><ol><li><strong>Pipelineï¼ˆç®¡é“ï¼‰</strong><ul><li>å¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šæ¡å‘½ä»¤ï¼ŒRedis æ‰¹é‡æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼ˆRTTï¼‰ã€‚</li><li>é€‚åˆæ‰¹é‡å†™å…¥æˆ–æ›´æ–°æ“ä½œã€‚</li></ul></li><li><strong>MGet &#x2F; MSet</strong><ul><li>æ‰¹é‡è·å–æˆ–è®¾ç½®å¤šä¸ª keyï¼Œä¸€æ¬¡è¯·æ±‚è¿”å›å¤šæ¡ç»“æœï¼Œé¿å…å¤šæ¬¡å•ç‹¬è¯·æ±‚ã€‚</li><li>é€‚åˆæ‰¹é‡è¯»å–ç¼“å­˜æ•°æ®ï¼Œæé«˜ååé‡ã€‚</li></ul></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pipe := rdb.Pipeline()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    pipe.Set(ctx, fmt.Sprintf(<span class="string">&quot;key%d&quot;</span>, i), i, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">_, err := pipe.Exec(ctx)</span><br></pre></td></tr></table></figure><h3 id="çƒ­ç‚¹-Key-å¤„ç†æŠ€å·§"><a href="#çƒ­ç‚¹-Key-å¤„ç†æŠ€å·§" class="headerlink" title="çƒ­ç‚¹ Key å¤„ç†æŠ€å·§"></a>çƒ­ç‚¹ Key å¤„ç†æŠ€å·§</h3><ol><li><strong>ç»™ Key åŠ éšæœºåç¼€åˆ†ç‰‡</strong><ul><li>å°†é«˜é¢‘è®¿é—®çš„çƒ­ç‚¹ Key æ‹†åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡ï¼Œä¾‹å¦‚ <code>user:123:1</code>ã€<code>user:123:2</code>â€¦â€¦</li><li>é¿å…å¤§é‡è¯·æ±‚é›†ä¸­åˆ°åŒä¸€ä¸ª Keyï¼Œç¼“è§£ Redis å•ç‚¹å‹åŠ›ã€‚</li></ul></li><li><strong>ç»“åˆæœ¬åœ°ç¼“å­˜</strong><ul><li>ä½¿ç”¨åº”ç”¨ç«¯ç¼“å­˜ï¼ˆå¦‚ <code>freecache</code>ã€<code>ristretto</code>ï¼‰å­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼Œå…ˆè¯»æœ¬åœ°ç¼“å­˜å†å›é€€åˆ° Redisã€‚</li><li>å‡å°‘å¯¹ Redis çš„è¯·æ±‚é¢‘ç‡ï¼Œæé«˜ç³»ç»Ÿååé‡å’Œå“åº”é€Ÿåº¦ã€‚</li></ul></li></ol></div></article></div><footer class="bg-gradient-to-r from-purple-700 to-blue-600 text-white py-8 mt-auto"><div class="container mx-auto px-4"><div class="flex flex-col md:flex-row md:justify-between md:items-start space-y-6 md:space-y-0"><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">å¿—å¼ºvlog</h3><p class="text-sm opacity-80">æ„Ÿè°¢æ‚¨çš„è®¿é—®ï¼è¿™é‡Œæ˜¯ ç‹å¿—å¼º ä¸“å±åšå®¢ï¼Œåˆ†äº«ç”Ÿæ´»ä¸æŠ€æœ¯ã€‚</p></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">å¿«æ·å¯¼èˆª</h3><ul class="space-y-2 text-sm opacity-90"><li><a href="/" class="hover:text-yellow-300 transition">Home</a></li><li><a href="/archives" class="hover:text-yellow-300 transition">Archives</a></li><li><a href="/resources" class="hover:text-yellow-300 transition">Rsources</a></li><li><a href="/tags" class="hover:text-yellow-300 transition">Tags</a></li><li><a href="/about" class="hover:text-yellow-300 transition">About</a></li><li><a href="/sitemap.xml" class="hover:text-yellow-300 transition">RSS</a></li></ul></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">å‹æƒ…é“¾æ¥</h3><ul class="space-y-2 text-sm opacity-90"><li><a href="https://cnb.cool/zhiqiangwang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">CNB</a></li><li><a href="https://github.com/chihqiang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">GitHub</a></li><li><a href="https://www.zhiqiang.wang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">å¿—å¼ºvlog</a></li></ul></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">è”ç³»æ–¹å¼</h3><p class="text-sm opacity-80 flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-18 8h18a2 2 0 002-2V8a2 2 0 00-2-2H3a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg> <a href="mailto:zhiqiang2033@gmail.com" class="hover:text-yellow-300">zhiqiang2033@gmail.com</a></p><p class="text-sm opacity-80 flex items-center space-x-2 mt-2"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M12 21s8-4.5 8-10a8 8 0 10-16 0c0 5.5 8 10 8 10z"/></svg> <span>ä¸­å›½</span></p></div></div><hr class="my-6 border-purple-400 opacity-50"><p class="text-center text-sm opacity-70 mb-2">Â© 2024 å¿—å¼ºvlog. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p><p class="text-center text-xs opacity-50">ç”± <a href="https://hexo.io/" target="_blank" rel="noopener" class="underline hover:text-yellow-300">Hexo</a> é©±åŠ¨ï¼Œä¸»é¢˜ç”± <a href="https://github.com/chihqiang/hexo-theme-tailog" target="_blank" rel="noopener" class="underline hover:text-yellow-300">hexo-theme-tailog</a> æä¾›ã€‚</p></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-TBH6G20B8Y"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TBH6G20B8Y")</script></footer><button id="back-to-top" class="fixed bottom-8 right-8 bg-gradient-to-r from-purple-500 to-blue-500 text-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 opacity-0 invisible z-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg></button></body></html>