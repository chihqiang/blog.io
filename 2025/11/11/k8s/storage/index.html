<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>解锁K8S存储：从原理到实战 | 志强vlog</title><meta name="keywords" content="kubernetes"><meta name="description" content="志强的个人博客，分享 Node.js、PHP、Go、Java 和 Python 后端开发经验，以及生活中的点滴感悟与故事。
"><meta property="og:type" content="article"><meta property="og:title" content="解锁K8S存储：从原理到实战 | 志强vlog"><meta property="og:description" content="志强的个人博客，分享 Node.js、PHP、Go、Java 和 Python 后端开发经验，以及生活中的点滴感悟与故事。
"><meta property="og:url" content="https://www.zhiqiang.wang/2025/11/11/k8s/storage/"><meta property="og:image" content="/img/favicon.ico"><meta property="og:site_name" content="志强vlog"><meta property="article:published_time" content="Tue Nov 11 2025 15:55:42 GMT+0800"><meta property="article:author" content="王志强"><meta property="article:tag" content="kubernetes"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="解锁K8S存储：从原理到实战 | 志强vlog"><meta name="twitter:description" content="志强的个人博客，分享 Node.js、PHP、Go、Java 和 Python 后端开发经验，以及生活中的点滴感悟与故事。
"><meta name="twitter:image" content="/img/favicon.ico"><script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "解锁K8S存储：从原理到实战",
      "image": "/img/favicon.ico",
      "author": {
        "@type": "Person",
        "name": "王志强"
      },
      "datePublished": "Tue Nov 11 2025 15:55:42 GMT+0800",
      "dateModified": "Thu Jan 08 2026 06:03:16 GMT+0000",
      "description": "志强的个人博客，分享 Node.js、PHP、Go、Java 和 Python 后端开发经验，以及生活中的点滴感悟与故事。
"
    }</script><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"><script>"dark"===localStorage.getItem("theme")||!localStorage.getItem("theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script src="https://cdn.tailwindcss.com/3.4.16"></script><script>tailwind.config={darkMode:"class",theme:{extend:{}}}</script><script src="https://unpkg.com/alpinejs@3.14.9/dist/cdn.min.js" defer></script><link rel="stylesheet" href="/css/blog.css"><script src="/js/blog.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body class="bg-gradient-to-br from-purple-100 to-blue-100 dark:from-gray-900 dark:to-gray-800 min-h-screen flex flex-col transition-colors duration-300"><nav id="navbar" class="bg-gradient-to-r from-purple-600 to-blue-500 shadow-lg dark:from-gray-800 dark:to-gray-700 transition-all duration-300 sticky top-0 z-40"><div class="container mx-auto px-4 py-3"><div class="flex justify-between items-center"><h1 class="text-white text-xl sm:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 to-pink-400"><a href="/">志强vlog</a></h1><div id="desktop-menu" class="hidden lg:flex items-center space-x-1"><a href="/" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="0">Home </a><a href="/archives" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="1">Archives </a><a href="/resources" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="2">Rsources </a><a href="/tags" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="3">Tags </a><a href="/about" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="4">About </a><a href="/sitemap.xml" class="nav-item text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10" data-index="5">RSS</a><div id="dropdown-menu" class="relative group hidden"><button class="text-white hover:text-yellow-200 transition duration-300 font-medium px-3 py-2 rounded-lg hover:bg-white/10 flex items-center">更多 <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div id="dropdown-content" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0"></div></div></div><div class="flex items-center space-x-1 sm:space-x-2"><button id="searchButton" class="p-2 sm:p-2.5 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-300 text-white hover:scale-110 active:scale-95" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg></button> <button id="theme-toggle" class="p-2 sm:p-2.5 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-300 text-white hover:scale-110 active:scale-95" aria-label="切换主题"><svg id="sun-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg> <svg id="moon-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg></button> <button id="mobile-menu-button" aria-label="切换菜单" class="lg:hidden p-2 sm:p-2.5 rounded-lg hover:bg-white/10 transition-all duration-300 text-white hover:scale-110 active:scale-95"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div></div></div><div id="mobile-menu" class="lg:hidden hidden bg-gradient-to-r from-purple-600 to-blue-500 dark:from-gray-800 dark:to-gray-700 px-4 pb-4 transition-all duration-300"><div class="space-y-1"><a href="/" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Home</span> </a><a href="/archives" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Archives</span> </a><a href="/resources" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Rsources</span> </a><a href="/tags" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">Tags</span> </a><a href="/about" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">About</span> </a><a href="/sitemap.xml" class="block text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-all duration-200 flex items-center group"><svg class="w-5 h-5 mr-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> <span class="font-medium group-hover:translate-x-1 transition-all duration-200">RSS</span></a></div></div></nav><div id="searchOverlay" class="overlay hidden"></div><div id="inputContainer" class="floating-search hidden"><input type="text" id="inputField" placeholder="搜索文章..." class="search-input" autocomplete="off"><div id="articleList" class="search-results"></div></div><script>document.addEventListener("DOMContentLoaded",DOMContentLoadedSearch)</script><div id="reading-progress" class="fixed top-0 left-0 h-1 bg-gradient-to-r from-purple-500 to-blue-500 z-50 transition-all duration-150" style="width:0%"></div><div class="container mx-auto px-4 py-8"><article class="bg-white p-6 sm:p-8 rounded-xl shadow-lg transition hover:scale-[1.01] max-w-5xl mx-auto mt-8"><header class="mb-6 sm:mb-8"><h1 class="text-3xl sm:text-4xl font-bold mb-3 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">解锁K8S存储：从原理到实战</h1><div class="flex flex-wrap items-center text-gray-500 text-sm space-x-4"><span>2025-11-11</span> <span><a href="/categories/%E8%BF%90%E7%BB%B4/" class="text-blue-600 hover:underline">运维</a> </span><span><a href="/tags/kubernetes/" class="text-blue-600 hover:underline">kubernetes</a></span></div></header><div class="article-content prose prose-base lg:prose-lg max-w-none"><p>在 Kubernetes（K8S）集群的复杂生态系统里，存储是一个关键的基础组成部分，如同数据的坚实港湾，对容器化应用程序的正常运行和数据管理起着不可替代的作用。在 K8S 环境中，容器化应用的部署、运行与扩展都高度依赖存储系统，存储不仅为应用提供了数据持久化的能力，确保数据在容器生命周期之外也能安全保存，还实现了容器间的数据共享，为分布式应用架构的协作提供了有力支持，因此，深入理解 K8S 存储的概念、类型和原理，对于构建高效、稳定的 Kubernetes 集群应用至关重要。</p><p>K8S 存储，从广义上来说，是指 Kubernetes 为容器化应用提供的一系列存储解决方案和管理机制，它涵盖了多种存储类型和抽象概念，旨在满足不同应用场景下的数据存储和访问需求。通过这些存储机制，K8S 实现了存储资源的动态供应、管理和回收，使应用开发者和运维人员能够更便捷地处理数据存储问题，而无需过多关注底层存储设备的细节。</p><h2 id="K8S-存储类型大揭秘"><a href="#K8S-存储类型大揭秘" class="headerlink" title="K8S 存储类型大揭秘"></a>K8S 存储类型大揭秘</h2><p>K8S 提供了多种存储类型，每种类型都有其独特的特点和适用场景，下面将介绍本地存储、网络存储和持久化存储这几种常见的存储类型。</p><h3 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h3><p>本地存储是将存储设备直接连接到 Kubernetes 节点上，供容器使用。这种存储方式具有低延迟、高带宽的优势，但也存在一些局限性，比如存储资源难以在节点间共享，并且当节点出现故障时，存储的数据可能会丢失。常见的本地存储类型有 EmptyDir 和 HostPath。</p><p>EmptyDir 是一种临时存储卷，它在 Pod 被分配到节点时创建，生命周期与 Pod 相同。当 Pod 从节点上移除时，EmptyDir 中的数据会被永久删除。这种存储类型适用于临时数据存储，如缓存数据、中间计算结果等场景。比如，在进行大数据处理时，可能需要在 Pod 中临时存储一些中间计算结果，就可以使用 EmptyDir。下面是一个 EmptyDir 的示例代码：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">emptydir-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello, EmptyDir&#x27; &gt; /data/message.txt; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>上述代码创建了一个名为 emptydir - pod 的 Pod，其中包含一个容器 container1，容器内将一条信息写入到 &#x2F;data&#x2F;message.txt 文件中，&#x2F;data 目录挂载了一个 EmptyDir 类型的存储卷 data-volume。EmptyDir 的优点是简单易用，不需要额外的配置，能够满足临时数据存储的需求；缺点是数据的持久性差，Pod 删除后数据丢失，且无法在节点间共享数据。</p><p>HostPath 则是将宿主机上的文件或目录挂载到 Pod 中，使容器能够访问宿主机的文件系统。它适用于需要访问宿主机特定文件或目录的场景，比如容器需要读取宿主机上的日志文件，或者需要与宿主机共享某些数据。假设我们要在容器中访问宿主机的 &#x2F;data 目录，可以使用以下示例代码：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostpath-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;ls /data; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span></span><br></pre></td></tr></table></figure><p>这段代码创建了一个名为 hostpath - pod 的 Pod，容器 container1 通过 volumeMounts 将名为 data-volume 的存储卷挂载到容器内的 &#x2F;data 目录，而 data-volume 是一个 HostPath 类型的存储卷，它将宿主机的 &#x2F;data 目录挂载到 Pod 中。HostPath 的优点是可以直接访问宿主机文件系统，实现容器与宿主机之间的数据共享；缺点是存在节点依赖性，当 Pod 被重新调度到其他节点时，可能无法访问原来的存储数据，并且安全性较低，容器可以访问宿主机的文件系统，存在潜在的安全风险。</p><h3 id="网络存储"><a href="#网络存储" class="headerlink" title="网络存储"></a>网络存储</h3><p>网络存储是通过网络连接的存储设备，可实现跨节点的数据共享和访问，具有较高的灵活性和可扩展性。常见的网络存储类型包括 NFS（Network File System）和 iSCSI（Internet Small Computer System Interface）等。</p><p>NFS 是一种基于网络的文件系统，允许客户端通过网络访问远程服务器上的文件系统，就像访问本地文件系统一样。在 Kubernetes 集群中，NFS 常用于实现多个 Pod 之间的数据共享，比如多个 Web 服务器 Pod 需要共享同一个静态文件目录，就可以使用 NFS 存储。下面是使用 NFS 作为存储卷的示例代码：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建NFS的PersistentVolume</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>  <span class="comment"># NFS服务器地址</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs-share</span>        <span class="comment"># NFS共享目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建NFS的PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Pod并挂载NFS存储卷</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">nfs-pvc</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello, NFS&#x27; &gt; /data/message.txt; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br></pre></td></tr></table></figure><p>上述代码首先创建了一个 NFS 类型的 PersistentVolume（nfs - pv），指定了存储容量、访问模式以及 NFS 服务器地址和共享目录；接着创建了一个 PersistentVolumeClaim（nfs - pvc），用于声明对存储资源的需求；最后创建了一个 Pod（nfs - pod），通过 persistentVolumeClaim 将 NFS 存储卷挂载到容器内的 &#x2F;data 目录。NFS 的优点是易于部署和管理，支持多节点同时读写，适合数据共享场景；缺点是性能相对较低，受网络带宽和稳定性影响较大，并且存在单点故障问题，如果 NFS 服务器出现故障，所有依赖该服务器的 Pod 都将无法访问数据。</p><p>iSCSI 是一种基于 IP 网络的存储协议，它将 SCSI 命令封装在 TCP&#x2F;IP 协议中，使服务器可以通过网络访问远程的存储设备。iSCSI 适用于对存储性能和可靠性要求较高的场景，如数据库应用等。在 Kubernetes 中使用 iSCSI 存储，需要配置 iSCSI 存储服务器，并在 Kubernetes 节点上安装 iSCSI initiator。以下是一个简单的 iSCSI 存储示例代码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建iSCSI的PersistentVolume</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">iscsi-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">iscsi:</span></span><br><span class="line">    <span class="attr">targetPortal:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span><span class="string">:3260</span>  <span class="comment"># iSCSI目标门户</span></span><br><span class="line">    <span class="attr">iqn:</span> <span class="string">iqn.2024-01.com.example:iscsi-target</span>  <span class="comment"># iSCSI Qualified Name</span></span><br><span class="line">    <span class="attr">lun:</span> <span class="number">0</span>  <span class="comment"># 逻辑单元号</span></span><br><span class="line">    <span class="attr">fsType:</span> <span class="string">ext4</span></span><br><span class="line">    <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建iSCSI的PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">iscsi-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Pod并挂载iSCSI存储卷</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">iscsi-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">iscsi-volume</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">iscsi-pvc</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello, iSCSI&#x27; &gt; /data/message.txt; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">iscsi-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br></pre></td></tr></table></figure><p>这段代码创建了一个 iSCSI 类型的 PersistentVolume（iscsi - pv），定义了存储容量、访问模式、iSCSI 目标门户、IQN、LUN 等参数；然后创建了对应的 PersistentVolumeClaim（iscsi - pvc）；最后在 Pod（iscsi - pod）中挂载了 iSCSI 存储卷。iSCSI 的优点是性能较好，数据传输可靠，支持多种操作系统和硬件设备；缺点是配置相对复杂，需要对网络和存储知识有一定了解，并且对网络要求较高，网络故障可能会影响存储访问。</p><h3 id="持久化存储"><a href="#持久化存储" class="headerlink" title="持久化存储"></a>持久化存储</h3><p>持久化存储是 Kubernetes 中用于确保数据在 Pod 生命周期之外仍然存在的存储方式，它通过 PersistentVolume（PV）和 PersistentVolumeClaim（PVC）来实现。</p><p>PV 是集群中由管理员创建和管理的存储资源，它代表了集群中的一块可供使用的存储空间。PV 可以是各种类型的存储，如本地存储、网络存储等，并且具有固定的存储容量、访问模式和回收策略。访问模式包括 ReadWriteOnce（RWO，只允许单个节点以读写方式挂载）、ReadOnlyMany（ROX，允许多个节点以只读方式挂载）、ReadWriteMany（RWX，允许多个节点以读写方式挂载）。回收策略定义了当 PV 不再被 PVC 绑定时如何处理，常见的回收策略有 Retain（保留数据，需要手动清理）、Delete（删除数据和 PV）、Recycle（已废弃，简单地清除文件系统）。</p><p>PVC 是用户对存储资源的请求，用户通过 PVC 声明需要的存储容量、访问模式和存储类等信息。Kubernetes 会根据 PVC 的要求，自动查找与之匹配的 PV 并进行绑定。如果没有找到合适的 PV，并且启用了动态供应，Kubernetes 会根据存储类的配置自动创建一个新的 PV。例如，一个有状态的应用（如 MySQL 数据库）需要持久化存储来保存数据，就可以通过 PVC 向集群请求存储资源，由 Kubernetes 负责分配 PV。下面是一个 PV 和 PVC 的示例代码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建PersistentVolume</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/mnt/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br></pre></td></tr></table></figure><p>上述代码创建了一个名为 my-pv 的 PV，使用 hostPath 类型的本地存储，容量为 2Gi，访问模式为 ReadWriteOnce，回收策略为 Retain；同时创建了一个名为 my-pvc 的 PVC，请求 2Gi 的存储容量和 ReadWriteOnce 的访问模式。当创建 Pod 时，可以通过引用 PVC 来使用 PV 提供的存储资源：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Pod并挂载PVC</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-volume</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">my-pvc</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello, PV/PVC&#x27; &gt; /data/message.txt; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br></pre></td></tr></table></figure><p>在这个 Pod 定义中，通过 persistentVolumeClaim 引用了 my-pvc，将 PV 挂载到容器内的 &#x2F;data 目录。PV 和 PVC 的优势在于实现了存储资源的抽象和动态管理，用户不需要关心底层存储的细节，只需要通过 PVC 声明需求，Kubernetes 会自动完成存储资源的分配和绑定，提高了存储管理的灵活性和效率，并且保证了数据的持久性和可靠性，即使 Pod 被删除或重新调度，数据依然可以保留在 PV 中 。</p><h2 id="K8S-存储工作原理深度剖析"><a href="#K8S-存储工作原理深度剖析" class="headerlink" title="K8S 存储工作原理深度剖析"></a>K8S 存储工作原理深度剖析</h2><h3 id="PV-和-PVC-的生命周期"><a href="#PV-和-PVC-的生命周期" class="headerlink" title="PV 和 PVC 的生命周期"></a>PV 和 PVC 的生命周期</h3><p>PV 和 PVC 的生命周期紧密相连，共同完成存储资源的管理和使用。</p><ul><li><strong>PV 创建阶段</strong>：PV 的创建有静态供应和动态供应两种方式。静态供应由管理员手动创建 PV 对象，通过编写 YAML 文件定义 PV 的各项参数，如存储容量、访问模式、回收策略以及存储类型相关的具体配置（如 NFS 的服务器地址和共享目录）。以 NFS 类型的 PV 为例，示例代码如下：</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">static-nfs-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs</span> <span class="bullet">-</span> <span class="string">share</span></span><br></pre></td></tr></table></figure><p>动态供应则是通过 StorageClass 的 Provisioner 自动创建 PV。当 PVC 申请存储时，Kubernetes 根据 StorageClass 的配置调用相应的存储插件（如 NFS CSI 驱动）来动态生成 PV，这种方式更适合云原生环境或按需分配存储的场景 。</p><ul><li><p><strong>PV 可用阶段</strong>：创建完成后的 PV 处于 Available 状态，此时 PV 已就绪，等待被 PVC 申领。在这个阶段，PV 就像一个准备出租的房子，各项设施都已完备，等待租客（PVC）的到来。它会根据 PVC 的 storageClassName、accessModes 和容量等需求来匹配合适的 PVC 。</p></li><li><p><strong>PV 与 PVC 绑定阶段</strong>：当有 PVC 的需求与 PV 的配置相匹配时，Kubernetes 会将 PV 和 PVC 进行绑定，绑定后 PV 的状态变为 Bound。例如，一个 PVC 请求 10Gi 的存储容量，访问模式为 ReadWriteOnce，而恰好有一个 PV 的配置与之相符，就会发生绑定。绑定示例代码如下：</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure><p>一旦绑定成功，PV 和 PVC 就建立了一对一的关系，该 PV 不可再被其他 PVC 使用 。</p><ul><li><p><strong>PV 使用阶段</strong>：Pod 通过 PVC 挂载 PV，实现数据的持久化存储。在这个阶段，应用程序可以对挂载的存储卷进行读写操作，数据被存储到后端存储设备中。比如，一个数据库 Pod 通过 PVC 挂载了 PV，数据库产生的数据就会持久化保存在 PV 对应的存储中，即使 Pod 被删除或重新调度，数据依然存在 。</p></li><li><p><strong>PV 释放阶段</strong>：当 PVC 被删除时，如果 PV 的回收策略为 Retain，PV 会进入 Released 状态。此时 PV 与 PVC 解除绑定，但存储卷上的数据会保留下来，不过需要管理员手动清理。例如，某个应用不再需要使用某个 PVC，删除 PVC 后，对应的 PV 进入 Released 状态，数据仍然留在存储设备上，管理员可以根据实际情况决定是否删除 PV 以及清理数据 。</p></li><li><p><strong>PV 回收阶段</strong>：PV 的回收策略决定了 PV 在释放后的处理方式。如果回收策略为 Delete，当 PVC 被删除时，PV 状态变为 Deleting，底层存储卷会自动通过 CSI 驱动删除。比如，对于一些云存储的 PV，如 AWS EBS，当 PVC 删除且 PV 回收策略为 Delete 时，对应的 EBS 卷会被删除；如果回收策略为 Retain，PV 释放后数据保留，需管理员手动删除 PV 和清理数据；而 Recycle 策略已被弃用，它原本是在 PV 释放后自动执行清理数据的操作，如<code>rm -rf /volume/*</code> 。</p></li></ul><h3 id="存储卷的挂载与使用"><a href="#存储卷的挂载与使用" class="headerlink" title="存储卷的挂载与使用"></a>存储卷的挂载与使用</h3><p>在 Kubernetes 中，Pod 挂载存储卷主要通过以下步骤实现：</p><ol><li><strong>创建存储卷</strong>：首先需要创建存储卷，存储卷可以是多种类型，如前面提到的本地存储（EmptyDir、HostPath）、网络存储（NFS、iSCSI）以及持久化存储（PV）。以创建一个 HostPath 类型的存储卷为例，示例代码如下：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostpath-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">container1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello, HostPath&#x27; &gt; /data/message.txt; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/host</span> <span class="bullet">-</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span></span><br></pre></td></tr></table></figure><p>在这个例子中，定义了一个名为<code>data-volume</code>的 HostPath 存储卷，它将宿主机的<code>/host - data</code>目录挂载到 Pod 中。</p><p>2. <strong>定义存储卷声明（可选）</strong>：对于持久化存储，通常需要创建 PersistentVolumeClaim（PVC）来声明对存储资源的需求。PVC 定义了所需的存储容量、访问模式和存储类等信息。例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">standard</span></span><br></pre></td></tr></table></figure><p>这个 PVC 请求 2Gi 的存储容量，访问模式为 ReadWriteOnce，存储类为 standard 。</p><p>3. <strong>在 Pod 中挂载存储卷</strong>：在 Pod 的定义中，通过<code>volumes</code>字段声明所需的存储卷，并在<code>containers</code>字段中的<code>volumeMounts</code>指定存储卷的挂载点。例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-volume</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">my-pvc</span></span><br></pre></td></tr></table></figure><p>上述代码中，Pod <code>my-pod</code>中的容器<code>my-container</code>将名为<code>my-volume</code>的存储卷挂载到<code>/usr/share/nginx/html</code>目录，而<code>my-volume</code>通过引用 PVC <code>my-pvc</code>来获取存储资源 。</p><p>在挂载存储卷时，需要注意以下事项：</p><ul><li><p><strong>访问模式匹配</strong>：PVC 和 PV 的访问模式必须匹配，否则无法绑定。例如，PVC 请求的访问模式为 ReadWriteOnce，而 PV 的访问模式为 ReadOnlyMany，两者不匹配，就不能成功绑定 。</p></li><li><p><strong>存储容量满足</strong>：PVC 请求的存储容量不能超过 PV 的容量。如果 PVC 请求 5Gi 的存储，而 PV 只有 3Gi，绑定也会失败 。</p></li><li><p><strong>存储卷类型支持</strong>：节点必须支持存储卷的类型，如使用 NFS 存储卷，节点上需要安装 NFS 客户端。如果节点不支持该存储卷类型，挂载操作将无法完成 。</p></li><li><p><strong>挂载路径冲突</strong>：同一个容器内不能将多个存储卷挂载到同一个路径，否则会导致挂载失败。同时，挂载路径在容器内必须是一个空目录或者不存在的目录，如果目录已存在且不为空，挂载时需要谨慎处理，避免覆盖原有数据 。</p></li></ul><h2 id="K8S-存储应用场景全解析"><a href="#K8S-存储应用场景全解析" class="headerlink" title="K8S 存储应用场景全解析"></a>K8S 存储应用场景全解析</h2><h3 id="有状态应用"><a href="#有状态应用" class="headerlink" title="有状态应用"></a>有状态应用</h3><p>在现代的分布式应用架构中，有状态应用占据着重要地位，数据库便是典型代表。以 MySQL 数据库为例，它在运行过程中需要持续记录事务日志、存储数据文件，这些数据对于业务的正常运转和数据完整性至关重要。在 K8S 环境下，为满足 MySQL 对数据持久化和一致性的严格要求，通常采用持久化存储机制，借助 PersistentVolume（PV）和 PersistentVolumeClaim（PVC）来实现。</p><p>PV 作为集群中预先配置好的存储资源，提供了稳定的存储空间，而 PVC 则是应用对存储资源的请求声明。当部署 MySQL Pod 时，通过 PVC 向集群申请特定大小和访问模式的存储资源，K8S 会自动将符合条件的 PV 与 PVC 进行绑定，将存储卷挂载到 MySQL Pod 中。比如，MySQL 的数据文件目录<code>/var/lib/mysql</code>可以挂载到 PVC 对应的 PV 存储卷上，这样即使 MySQL Pod 因为节点故障、资源调度等原因被删除或重新创建，其存储在 PV 中的数据依然完好无损，重新启动的 Pod 能够基于原有数据继续提供服务，保证了数据库服务的连续性和数据一致性 。</p><p>同时，为确保数据的一致性，在多副本的 MySQL 集群场景中，常采用分布式存储系统，并结合 K8S 的 StatefulSet 控制器。StatefulSet 为每个 Pod 分配唯一且稳定的标识符，保证了 Pod 在不同节点间迁移时，能够准确地访问到属于自己的存储卷，维持数据的一致性。例如，在一个三节点的 MySQL 集群中，每个 MySQL 实例都有自己对应的 PV，通过 StatefulSet 的有序部署和管理，确保了主从节点之间的数据同步和一致性，即使某个节点出现故障，其他节点也能基于一致的数据继续提供服务 。</p><h3 id="日志存储与管理"><a href="#日志存储与管理" class="headerlink" title="日志存储与管理"></a>日志存储与管理</h3><p>在 K8S 集群中，日志是记录应用运行状态、排查故障的重要依据，对日志进行集中收集和管理至关重要。K8S 存储为此提供了强大的支持，通过多种方式实现日志的高效管理。一种常见的方式是利用 DaemonSet 在每个节点上部署日志收集代理，如 Fluentd、Filebeat 等。这些代理以容器的形式运行，通过挂载宿主机上的容器日志目录，将容器产生的日志文件收集起来，并转发到后端的日志存储系统，如 Elasticsearch。</p><p>以 Fluentd 为例，它以 DaemonSet 的方式部署在 K8S 集群的每个节点上，通过配置文件指定要收集的日志路径（如<code>/var/log/containers/*.log</code>，这是 Kubernetes 容器日志的默认存储路径）。Fluentd 会实时监控这些路径下的日志文件变动，一旦有新的日志产生，便将其收集起来，并根据配置的输出插件将日志发送到 Elasticsearch 中进行存储。这种方式实现了日志的集中收集，方便对整个集群的日志进行统一管理和分析 。</p><p>K8S 存储在日志管理方面具有显著优势。首先，实现了日志与应用的解耦，即使应用容器被删除或重新部署，日志依然能够完整地保存下来，不会因为应用的生命周期变化而丢失。其次，便于大规模集群的日志管理，通过统一的配置和部署，能够快速地在整个集群范围内收集和管理日志，提高了运维效率。再者，结合 Elasticsearch 和 Kibana 等工具，能够实现日志的快速检索、可视化展示和分析，帮助运维人员及时发现和解决问题 。</p><h3 id="数据共享与协作"><a href="#数据共享与协作" class="headerlink" title="数据共享与协作"></a>数据共享与协作</h3><p>在复杂的分布式应用场景中，多个 Pod 之间常常需要进行数据共享和协作，K8S 存储为此提供了有效的解决方案。例如，在一个数据分析项目中，可能有数据采集 Pod 负责从不同数据源收集数据，数据处理 Pod 对收集到的数据进行清洗、分析，而数据展示 Pod 则将处理后的数据以可视化的方式呈现给用户。在这个过程中，数据采集 Pod 需要将采集到的数据共享给数据处理 Pod，数据处理 Pod 处理后的数据又要共享给数据展示 Pod 。</p><p>通过 K8S 的共享存储机制，如 NFS（Network File System）存储卷，可以实现多个 Pod 之间的数据共享。首先创建一个 NFS 类型的 PersistentVolume（PV），指定 NFS 服务器地址和共享目录；然后创建 PersistentVolumeClaim（PVC），用于声明对该 PV 的使用需求；最后在需要共享数据的 Pod 中，通过挂载 PVC 对应的存储卷，实现对共享数据的访问。比如，数据采集 Pod 将采集到的数据写入到挂载的 NFS 存储卷中，数据处理 Pod 和数据展示 Pod 通过相同的挂载路径，即可读取到这些数据，从而实现了多个 Pod 之间的数据共享和协作 。</p><p>除了 NFS，像 GlusterFS、CephFS 等分布式文件系统也可用于 K8S 集群中实现数据共享，它们提供了更高的性能、可靠性和可扩展性，适用于不同规模和需求的分布式应用场景，助力多个 Pod 之间高效地进行数据交互与协作，推动整个分布式应用系统的稳定运行 。</p><h2 id="总结与展望"><a href="#总结与展望" class="headerlink" title="总结与展望"></a>总结与展望</h2><p>在 Kubernetes 的生态系统中，存储无疑是至关重要的一环，它为容器化应用的稳定运行和数据管理提供了坚实保障。通过对 K8S 存储类型、工作原理、应用场景以及实战部署的深入探索，我们全面了解了 K8S 存储的强大功能和多样性。本地存储、网络存储和持久化存储等多种类型，满足了不同应用场景下的数据存储需求，从临时数据存储到数据持久化与共享，K8S 存储都能游刃有余地应对 。</p><p>PV 和 PVC 的生命周期管理以及存储卷的挂载与使用机制，确保了存储资源的高效利用和动态分配，使得应用与存储实现解耦，提高了系统的灵活性和可扩展性。在有状态应用、日志存储与管理、数据共享与协作等实际应用场景中，K8S 存储发挥了关键作用，助力企业构建高效、可靠的分布式应用架构 。</p><p>随着容器技术和云原生的不断发展，K8S 存储也将持续演进。未来，K8S 存储有望在性能优化、数据安全、多云和混合云环境的适配等方面取得更大突破。例如，在性能优化上，通过优化存储插件和底层存储架构，进一步提升数据读写速度和存储资源利用率；在数据安全方面，加强数据加密、访问控制等安全机制，保障数据的安全性和隐私性；在多云和混合云环境下，实现更便捷的数据迁移和存储资源统一管理，降低企业在复杂云环境下的运维成本 。</p><p>对于从事 Kubernetes 相关工作的开发者和运维人员来说，持续关注 K8S 存储的发展动态，不断学习和实践新的存储技术和应用场景，将有助于提升自身的技术能力和竞争力。希望读者通过本文对 K8S 存储有了更深入的理解和认识，并能够在实际工作中灵活运用 K8S 存储技术，构建出更加稳定、高效的容器化应用系统 。</p></div></article></div><footer class="bg-gradient-to-r from-purple-700 to-blue-600 text-white py-8 mt-auto"><div class="container mx-auto px-4"><div class="flex flex-col md:flex-row md:justify-between md:items-start space-y-6 md:space-y-0"><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">志强vlog</h3><p class="text-sm opacity-80">感谢您的访问！这里是 王志强 专属博客，分享生活与技术。</p></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">快捷导航</h3><ul class="space-y-2 text-sm opacity-90"><li><a href="/" class="hover:text-yellow-300 transition">Home</a></li><li><a href="/archives" class="hover:text-yellow-300 transition">Archives</a></li><li><a href="/resources" class="hover:text-yellow-300 transition">Rsources</a></li><li><a href="/tags" class="hover:text-yellow-300 transition">Tags</a></li><li><a href="/about" class="hover:text-yellow-300 transition">About</a></li><li><a href="/sitemap.xml" class="hover:text-yellow-300 transition">RSS</a></li></ul></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">友情链接</h3><ul class="space-y-2 text-sm opacity-90"><li><a href="https://cnb.cool/zhiqiangwang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">CNB</a></li><li><a href="https://github.com/chihqiang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">GitHub</a></li><li><a href="https://www.zhiqiang.wang" target="_blank" rel="noopener" class="hover:text-yellow-300 transition">志强vlog</a></li></ul></div><div class="md:w-1/4"><h3 class="text-xl font-semibold mb-3">联系方式</h3><p class="text-sm opacity-80 flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-18 8h18a2 2 0 002-2V8a2 2 0 00-2-2H3a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg> <a href="mailto:zhiqiang2033@gmail.com" class="hover:text-yellow-300">zhiqiang2033@gmail.com</a></p><p class="text-sm opacity-80 flex items-center space-x-2 mt-2"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M12 21s8-4.5 8-10a8 8 0 10-16 0c0 5.5 8 10 8 10z"/></svg> <span>中国</span></p></div></div><hr class="my-6 border-purple-400 opacity-50"><p class="text-center text-sm opacity-70 mb-2">© 2024 志强vlog. 保留所有权利.</p><p class="text-center text-xs opacity-50">由 <a href="https://hexo.io/" target="_blank" rel="noopener" class="underline hover:text-yellow-300">Hexo</a> 驱动，主题由 <a href="https://github.com/chihqiang/hexo-theme-tailog" target="_blank" rel="noopener" class="underline hover:text-yellow-300">hexo-theme-tailog</a> 提供。</p></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-TBH6G20B8Y"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TBH6G20B8Y")</script></footer><button id="back-to-top" class="fixed bottom-8 right-8 bg-gradient-to-r from-purple-500 to-blue-500 text-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 opacity-0 invisible z-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg></button></body></html>